{% extends "base.html" %}
{% load i18n static %}

{% block content %}
<body class="bg-secondary">
    <div class="container" id="maindiv">
        <h1 class="text-center bg-primary">{{ voting.id }} - <div id="name">{{ voting.name }}</div></h1>

        {% if not voting.start_date %}
            <h2 class="text-danger">{% trans ' Voting not started' %}</h2>
        {% elif not voting.end_date %}
            <h2 class="text-warning">{% trans ' Voting is opened' %}</h2>
        {% else %}

            <h2 class="text-left bg-secondary">{% trans ' Results table: ' %}</h2>

            <ul>  
                {% trans 'Answer: ' %} {{voting.question.desc}}</br>
                {% trans 'Description: ' %} {{voting.desc}}</br>
                {% trans 'Start date: ' %}{{voting.start_date}}</br>
                {% trans 'End date: ' %}{{voting.end_date}}</br>
                {% trans 'Total votes: ' %}{{voting.tally|length}}</br>

                <table class="table">
                    <thead>
                      <tr>
                        <th>Options</th>
                        <th>Total votes</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        {% for option in voting.postproc %}
                        <td>{{option.option}}</td>
                        <td>{{option.votes}}</td>
                      </tr>
                        {% endfor %} 
                    </tbody>
                  </table>
            </ul>
        {% endif %}
    </div>

    <div class="container">
        <canvas id="myChart"></canvas>   
    </div>

    <div id="showtitle"></div>
    <div id="showoptions"></div>
    <div id="showdata"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.js"></script>
<script>
    var myChart = document.getElementById('myChart').getContext('2d');
    var allDivTd = document.getElementById("maindiv").getElementsByTagName("TD");
    var title = document.getElementById("name").innerHTML;

    var data = [];
    var labels = [];
    
for(var i = 0; i < allDivTd.length; i++){
    var td = allDivTd[i];
    if(i%2 != 0){
        data.push(parseInt(td.innerHTML));
    }else{
        labels.push(td.innerHTML);
    }
}
    document.getElementById("showtitle").innerHTML=title;
    document.getElementById("showdata").innerHTML=data[0]+data[1]+data[2];
    document.getElementById("showoptions").innerHTML = labels[0] + labels[1]+ labels[2];

    var firstChart = new Chart(myChart,{
        type:'bar', //bar, horizontalBar, pie, line ,doughnut, radar, polarArea
        data:{
            labels,
            datasets:[{title, data}]
        },
        options:{}
    });

</script>

</body>

{% endblock %}